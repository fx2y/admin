clear
cd ~/workspace-demo/go-demo-app-ops/cicd
@_ECHO_ON

k get all -n kpack
k api-resources --api-group build.pivotal.io
k get bldr,bld,clstbldr,img,sourceresolvers -A
cp -ri $DEMO/kpack/cicd/kpack .
cd kpack
ls -l

yqc builder.yaml
yqc image.yaml

kns default
k apply -f builder.yaml -f image.yaml

k get builds
k describe build
k get pods

logs -image go-demo-app -build 1

pack suggest-stacks
pack inspect-builder gcr.io/paketo-buildpacks/builder:base-platform-api-0.3

yqc -d 0 custom-builder.yaml
yqc -d 1 custom-builder.yaml
yqc -d 2 custom-builder.yaml
k apply -f custom-builder.yaml
k get custombuilder

## Build images

catd image.yaml image-1.yaml
catd image-1.yaml image-2.yaml

k apply -f image-1.yaml -f image-2.yaml -f image-3.yaml
k get builds
k describe build
logs -image go-demo-app-1 -build 1

## Rebase images

sed -i '' 's/run:0.0.19-base-cnb/run:0.0.20-base-cnb/g' custom-builder.yaml
k apply -f custom-builder.yaml
logs -image go-demo-app-1 -build 2
k describe build
