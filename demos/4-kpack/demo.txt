clear
cd ~/workspace-demo/go-demo-app-ops/cicd/kpack-demo
kns default

k apply -f ../kpack/sa.yaml

@_ECHO_ON

# kpack CRDs
k api-resources --api-group build.pivotal.io
k api-resources --api-group experimental.kpack.pivotal.io

# Simple setup
yqc ../kpack/builder.yaml
yqc ../image/image.yaml

# Piece-meal setup (CustomBuilder)

yqc -d 0 cb.yaml; yqc -d 1 cb.yaml; yqc -d 2 cb.yaml

k apply -f cb.yaml
k get custombuilder

# Images

yqc img-1.yaml

k apply -f img-1.yaml -f img-2.yaml -f img-3.yaml

k get builds

k describe build

# Rebase images

sed -i '' 's/run:0.0.19-base-cnb/run:0.0.20-base-cnb/g' cb.yaml
k apply -f cb.yaml

k get builds
k describe build

#logs -image demo-img-1 -build 2

k delete -f .
@_SKIP# Result: kpack checks image.yaml and pushes to Docker Hub
