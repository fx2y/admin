clear
cd ~/workspace-demo/go-demo-app-ops/cicd/argo
@_ECHO_ON

kns argocd
k get all
k api-resources --api-group argoproj.io
k get apps,appprojs
k port-forward svc/argocd-server 8080:80 2>&1 > /dev/null &
k get pods
argocd login localhost:8080 --insecure --username admin

yqc argo-deploy-dev.yaml
k apply -f argo-deploy-dev.yaml

cd ../../ops/overlays/dev
yq w -i kustomization.yaml namePrefix dev-
git commit -am 'Add prefix dev-'
git push origin master
# Prune

cd ../prod
k apply -f argo-deploy-prod.yaml
argocd app set prod-go-demo-app --self-heal

kns prod
k delete deploy prod-go-demo-app; kubectl get rs

# Result: dev/prod-go-demo-app installed and kept up-to-date
