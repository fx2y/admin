clear
@_ECHO_ON

cd ~/workspace-demo
mkdir go-demo-app-ops
mv go-demo-app/ops go-demo-app-ops
mv go-demo-app/cicd go-demo-app-ops/cicd
tree .
sed -i '' 's/go-demo-app.git/go-demo-app-ops.git/g' go-demo-app-ops/cicd/argo/argo-deploy-dev.yaml
sed -i '' 's/go-demo-app.git/go-demo-app-ops.git/g' go-demo-app-ops/cicd/argo/argo-deploy-prod.yaml
kns argocd
k apply -f go-demo-app-ops/cicd/argo
cd go-demo-app
git add -A
git commit -m "Moved ops and cicd directories to their own repo"
git push origin master
cd ../go-demo-app-ops
git init
hub create
git add -A
git commit -m "Files moved from go-demo-app repo"
git push origin master


cd cicd/tekton
cp -r $DEMO/automatic-deployment/cicd/tekton/ .
ls -l

yqc ops-dev-event-listener.yaml
yqc ops-dev-trigger-binding.yaml
yqc ops-dev-pipeline.yaml
yqc ops-dev-trigger-binding.yaml
yqc ops-dev-task.yaml

kns tekton-pipelines
k apply -f .

. ${HOME}/create_dockerhub_webhook.sh

cd ../../../go-demo-app
sed -i '' 's/sunshine/pipeline/g' hello-server.go
git commit -am "Hello pipeline"
git push origin master

tkn pipelinerun list
tkn pipelinerun logs -f
tkn pipelinerun list
tkn pipelinerun logs -f

kns dev
k get rs
k port-forward svc/dev-go-demo-app 8081:8080 &
curl localhost:8081
kill
