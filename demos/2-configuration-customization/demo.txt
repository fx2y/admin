clear
cd ~/workspace-demo/go-demo-app
@_ECHO_ON

# Remove duplication

catd deployment.yaml deployment-prod.yaml
catd service.yaml service-prod.yaml
rm -rf *.yaml
cd ..
cd go-demo-app-ops
cd ops/base
yqc deployment.yaml
yqc service.yaml

cd ../overlays/dev
yqc kustomization.yaml
kns dev
kustomize build --load_restrictor none .
kustomize build --load_restrictor none . | kubectl apply -f -
k get all
kns prod
cd ../prod
yqc kustomization.yaml
yqc env_patch.yaml
yqc kustomization.yaml
kustomize build --load_restrictor none . | kubectl apply -f -
k get all
k delete deploy go-demo-app
k delete svc go-demo-app

k get all --show-labels
k describe pod
k logs
